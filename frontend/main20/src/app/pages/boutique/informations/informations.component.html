<div class="row">
    <div class="col-12">
        <mat-card class="cardWithShadow">
            <mat-card-header>
                <mat-card-title>{{ isOwner ? 'Configuration de ma boutique' : boutique?.nom }}</mat-card-title>
                <mat-card-subtitle>{{ isOwner ? 'Gérez vos informations et horaires' : 'Informations sur la boutique'
                    }}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content class="p-24">
                @if (isLoading) {
                <div class="d-flex justify-content-center p-24">
                    <mat-spinner diameter="40"></mat-spinner>
                </div>
                } @else {
                <form [formGroup]="form" (ngSubmit)="save()">
                    <!-- Informations Générales -->
                    <h4 class="mat-headline-6 m-b-16">Informations Générales</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Nom de la boutique</mat-label>
                                <input matInput formControlName="nom" placeholder="Nom de votre boutique"
                                    [readonly]="!isOwner">
                                @if (form.get('nom')?.hasError('required')) {
                                <mat-error>Le nom est requis</mat-error>
                                }
                            </mat-form-field>
                        </div>
                        <div class="col-lg-6">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Téléphone</mat-label>
                                <input matInput formControlName="telephone" placeholder="Ex: +26134..." type="tel"
                                    [readonly]="!isOwner">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-6">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Email de contact</mat-label>
                                <input matInput formControlName="email" placeholder="contact@maboutique.com"
                                    type="email" [readonly]="!isOwner">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-6">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Adresse</mat-label>
                                <input matInput formControlName="adresse" placeholder="Adresse physique"
                                    [readonly]="!isOwner">
                            </mat-form-field>
                        </div>
                        <div class="col-12">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Description</mat-label>
                                <textarea matInput formControlName="description" rows="3"
                                    placeholder="Parlez-nous de votre boutique..." [readonly]="!isOwner"></textarea>
                            </mat-form-field>
                        </div>
                    </div>

                    <mat-divider class="m-y-24"></mat-divider>

                    <!-- Horaires -->
                    <div class="d-flex align-items-center justify-content-between m-b-16">
                        <h4 class="mat-headline-6 m-0">Horaires d'ouverture</h4>
                        @if (isOwner) {
                        <button type="button" mat-stroked-button color="primary" (click)="addHoraire()">
                            <mat-icon ripple="false">add</mat-icon> Ajouter une plage
                        </button>
                        }
                    </div>

                    <div formArrayName="horaires">
                        @for (item of horairesFormArray.controls; track $index) {
                        <div [formGroupName]="$index" class="row align-items-center m-b-8">
                            <div class="col-lg-4">
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Jour</mat-label>
                                    <mat-select formControlName="jour">
                                        @for (j of jours; track j) {
                                        <mat-option [value]="j">{{ j | titlecase }}</mat-option>
                                        }
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-lg-3">
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Ouverture</mat-label>
                                    <input matInput type="time" formControlName="ouverture" [readonly]="!isOwner">
                                </mat-form-field>
                            </div>
                            <div class="col-lg-3">
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Fermeture</mat-label>
                                    <input matInput type="time" formControlName="fermeture" [readonly]="!isOwner">
                                </mat-form-field>
                            </div>
                            <div class="col-lg-2">
                                @if (isOwner) {
                                <button type="button" mat-icon-button color="warn" (click)="removeHoraire($index)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                                }
                            </div>
                        </div>
                        } @empty {
                        <p class="text-muted p-16">Aucun horaire renseigné.</p>
                        }
                    </div>

                    <mat-divider class="m-y-24"></mat-divider>

                    <!-- Options -->
                    @if (isOwner || boutique?.clickCollectActif || boutique?.accepteLivraisonJourJ) {
                    <h4 class="mat-headline-6 m-b-16">Options de service</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <mat-slide-toggle formControlName="clickCollectActif" color="primary" [disabled]="!isOwner">
                                Service Click & Collect
                            </mat-slide-toggle>
                        </div>
                        <div class="col-lg-6">
                            <mat-slide-toggle formControlName="accepteLivraisonJourJ" color="primary"
                                [disabled]="!isOwner">
                                Livraison Jour J
                            </mat-slide-toggle>
                        </div>
                    </div>
                    }

                    @if (isOwner) {
                    <div class="m-t-32 d-flex justify-content-end">
                        <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid || isSaving">
                            @if (isSaving) {
                            <mat-spinner diameter="20" class="m-r-8 d-inline-block"></mat-spinner>
                            Enregistrement...
                            } @else {
                            Enregistrer les modifications
                            }
                        </button>
                    </div>
                    }
                </form>
                }
            </mat-card-content>
        </mat-card>
    </div>
</div>