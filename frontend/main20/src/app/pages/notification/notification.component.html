<div class="row">
  <div class="col-12">
    <mat-card class="cardWithShadow">
      <mat-card-header>
        <mat-card-title>Notifications</mat-card-title>
        <mat-card-subtitle>
          Vous avez {{ getUnreadCount() }} notification(s) non lue(s)
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="loading" class="text-center p-4">Chargement...</div>

        <div *ngIf="!loading && notifications.length === 0" class="text-center p-4">
          Aucune notification.
        </div>

        <mat-list *ngIf="!loading && notifications.length > 0">
          <div *ngFor="let notification of notifications">
            <mat-list-item [class.unread]="!notification.lu" class="notification-item">
              <div class="notification-content">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <h3 matListItemTitle class="m-0" [class.fw-bold]="!notification.lu">
                    {{ notification.titre }}
                  </h3>
                  <button
                    *ngIf="!notification.lu"
                    mat-icon-button
                    color="primary"
                    (click)="markAsRead(notification._id)"
                    matTooltip="Marquer comme lu"
                  >
                    <mat-icon>check_circle_outline</mat-icon>
                  </button>
                  <span *ngIf="notification.lu" class="text-success">
                    <mat-icon>check_circle</mat-icon>
                  </span>
                </div>
                <p matListItemLine class="notification-message">{{ notification.message }}</p>
                <p matListItemLine class="text-muted small">
                  {{ notification.createdAt | date: 'medium' }}
                  <span
                    *ngIf="notification.channel === 'email' || notification.channel === 'all'"
                    class="ms-2 badge bg-light text-dark border"
                  >
                    Email: {{ notification.emailStatus }}
                  </span>
                </p>
              </div>
            </mat-list-item>
            <mat-divider></mat-divider>
          </div>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>
</div>
