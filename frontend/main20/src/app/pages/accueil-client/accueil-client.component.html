<mat-card class="cardWithShadow">
  <mat-card-content>
    <div class="d-flex flex-wrap gap-16 align-items-center justify-content-between">
      <div>
        <mat-card-title>Accueil</mat-card-title>
        <mat-card-subtitle>
          Retrouvez tous les produits disponibles dans les differentes boutiques.
        </mat-card-subtitle>
      </div>
      <mat-button-toggle-group [formControl]="viewModeControl" aria-label="Mode d'affichage">
        <mat-button-toggle value="pagination">Pagination</mat-button-toggle>
        <mat-button-toggle value="infinite">Infinite scroll</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <div class="d-flex flex-wrap gap-16 m-t-16 align-items-end">
      <mat-form-field appearance="outline" class="flex-grow-1">
        <mat-label>Recherche</mat-label>
        <input
          matInput
          [formControl]="searchControl"
          placeholder="Produit ou boutique"
          [disabled]="isLoading"
        />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Categorie</mat-label>
        <mat-select [formControl]="categoryControl" [disabled]="isLoadingCategories">
          <mat-option value="all">Toutes</mat-option>
          @for (category of categories; track category._id) {
            <mat-option [value]="category._id">{{ category.nom }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Tri</mat-label>
        <mat-select [formControl]="sortControl">
          <mat-option value="name-asc">Nom A-Z</mat-option>
          <mat-option value="name-desc">Nom Z-A</mat-option>
          <mat-option value="price-asc">Prix croissant</mat-option>
          <mat-option value="price-desc">Prix decroissant</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="d-flex flex-wrap gap-16 m-t-16">
      <mat-form-field appearance="outline">
        <mat-label>Prix min</mat-label>
        <input matInput type="number" min="0" [formControl]="minPriceControl" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Prix max</mat-label>
        <input matInput type="number" min="0" [formControl]="maxPriceControl" />
      </mat-form-field>
    </div>

    @if (isLoading && !cards.length) {
      <div class="p-16">Chargement en cours...</div>
    } @else if (errorMessage) {
      <div class="p-16 text-error">{{ errorMessage }}</div>
    } @else if (!displayCards.length) {
      <div class="p-16 text-muted">Aucun produit trouve.</div>
    } @else {
      <app-blog-card
        [productcards]="displayCards"
        [showFallback]="false"
        [detailRouteBase]="'/produit'"
      ></app-blog-card>

      @if (viewModeControl.value === 'pagination') {
        <mat-paginator
          class="m-t-16"
          [length]="total"
          [pageIndex]="page - 1"
          [pageSize]="limit"
          [pageSizeOptions]="[8, 12, 24, 48]"
          [showFirstLastButtons]="true"
          (page)="onPageChange($event)"
        >
        </mat-paginator>
      } @else {
        <div class="d-flex justify-content-center m-t-16">
          @if (isLoadingMore) {
            <mat-progress-spinner diameter="28" mode="indeterminate"></mat-progress-spinner>
          } @else if (!hasMore) {
            <span class="text-muted">Fin des produits.</span>
          }
        </div>
        <div #infiniteTrigger class="p-8"></div>
      }
    }
  </mat-card-content>
</mat-card>
