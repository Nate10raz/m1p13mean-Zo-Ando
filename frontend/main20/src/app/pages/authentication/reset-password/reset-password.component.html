<div class="auth-wrapper">
  <div class="auth-blob auth-blob--1"></div>
  <div class="auth-blob auth-blob--2"></div>

  <div class="auth-card-wrap">
    <mat-card class="cardWithShadow auth-card">
      <mat-card-content>
        <div class="auth-logo">
          <a [routerLink]="['/']" class="app-brand">
            <span class="app-brand__icon bg-light-primary text-primary">
              <i-tabler name="building-store" class="icon-20 d-flex"></i-tabler>
            </span>
            <span class="app-brand__name">MarketPlace</span>
          </a>
        </div>

        <div class="auth-title">
          <h2 class="f-s-20 f-w-700 m-0">Reinitialiser le mot de passe</h2>
          <p class="text-muted f-s-13 m-0 m-t-4">
            Definissez un nouveau mot de passe pour votre compte.
          </p>
        </div>

        <form [formGroup]="form" (ngSubmit)="submit()">
          <div class="auth-field">
            <mat-label class="auth-field__label">Nouveau mot de passe</mat-label>
            <mat-form-field appearance="outline" class="w-100" color="primary">
              <i-tabler
                name="lock"
                class="icon-18 d-flex"
                matPrefix
                style="margin-right: 8px; color: var(--mat-sys-primary); opacity: 0.7"
              ></i-tabler>
              <input
                matInput
                [type]="showNewPassword ? 'text' : 'password'"
                formControlName="newPassword"
                autocomplete="new-password"
                placeholder="••••••••"
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="showNewPassword = !showNewPassword"
                [attr.aria-label]="showNewPassword ? 'Masquer' : 'Afficher'"
              >
                <mat-icon>{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="f.newPassword.touched && f.newPassword.hasError('required')">
                Nouveau mot de passe requis.
              </mat-error>
            </mat-form-field>
          </div>

          <div class="auth-field">
            <mat-label class="auth-field__label">Confirmer le mot de passe</mat-label>
            <mat-form-field appearance="outline" class="w-100" color="primary">
              <i-tabler
                name="lock"
                class="icon-18 d-flex"
                matPrefix
                style="margin-right: 8px; color: var(--mat-sys-primary); opacity: 0.7"
              ></i-tabler>
              <input
                matInput
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                autocomplete="new-password"
                placeholder="••••••••"
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="showConfirmPassword = !showConfirmPassword"
                [attr.aria-label]="showConfirmPassword ? 'Masquer' : 'Afficher'"
              >
                <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <mat-error *ngIf="f.confirmPassword.touched && f.confirmPassword.hasError('required')">
                Confirmation requise.
              </mat-error>
              <mat-error *ngIf="form.hasError('passwordMismatch') && f.confirmPassword.touched">
                Les mots de passe ne correspondent pas.
              </mat-error>
            </mat-form-field>
          </div>

          <div *ngIf="serverError" class="auth-server-error">
            <i-tabler name="alert-circle" class="icon-16 d-flex"></i-tabler>
            {{ serverError }}
          </div>

          <button
            type="submit"
            mat-flat-button
            color="primary"
            class="w-100 auth-submit"
            [disabled]="form.invalid || isSubmitting || !token"
          >
            {{ isSubmitting ? 'Reinitialisation...' : 'Reinitialiser' }}
          </button>
        </form>

        <div class="auth-register">
          <a [routerLink]="['/client/login']" class="text-primary f-w-600 text-decoration-none">
            Retour à la connexion
          </a>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
