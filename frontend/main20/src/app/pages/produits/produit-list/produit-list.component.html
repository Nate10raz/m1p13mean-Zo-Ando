<mat-card class="cardWithShadow">
  <mat-card-content>
    <div class="d-flex flex-wrap gap-16 align-items-center justify-content-between">
      <div>
        <mat-card-title>Liste des produits</mat-card-title>
        <mat-card-subtitle>Produits visibles pour admin et boutique</mat-card-subtitle>
      </div>
      <button mat-flat-button color="primary" [routerLink]="['/produits/nouveau']">
        Nouveau produit
      </button>
    </div>

    <div class="d-flex flex-wrap gap-16 m-t-16 align-items-end">
      <mat-form-field appearance="outline" class="flex-grow-1">
        <mat-label>Recherche</mat-label>
        <input
          matInput
          [formControl]="searchControl"
          placeholder="Titre ou slug"
          [disabled]="isLoading"
        />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Statut</mat-label>
        <mat-select [formControl]="statusControl" [disabled]="isLoading">
          <mat-option value="all">Tous</mat-option>
          <mat-option value="active">Actif</mat-option>
          <mat-option value="inactive">Inactif</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    @if(isLoading) {
    <div class="p-16">Chargement en cours...</div>
    } @else if(errorMessage) {
    <div class="p-16 text-error">{{ errorMessage }}</div>
    } @else if(!dataSource.length) {
    <div class="p-16 text-muted">Aucun produit trouve.</div>
    } @else {
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" [trackBy]="trackByProductId" class="w-100">
        <ng-container matColumnDef="produit">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14 p-l-0">Produit</th>
          <td mat-cell *matCellDef="let element" class="p-l-0">
            <div class="d-flex align-items-center">
              <img [src]="element.image" alt="produit" width="48" class="rounded" />
              <div class="m-l-16">
                <h6 class="f-s-14 f-w-600 m-0">{{ element.titre }}</h6>
                <span class="f-s-12 text-muted">{{ element.slug }}</span>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="categorie">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14">Categorie</th>
          <td mat-cell *matCellDef="let element">
            <span class="f-s-13">{{ getCategoryLabel(element.categorieId) }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="prix">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14">Prix</th>
          <td mat-cell *matCellDef="let element">
            <span class="f-w-600">{{ formatPrice(element.prix) }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14">Stock</th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.stock }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14">Statut</th>
          <td mat-cell *matCellDef="let element">
            @if(element.estActif) {
            <span class="bg-light-success text-success rounded f-w-600 p-6 p-y-4 f-s-12">Actif</span>
            } @else {
            <span class="bg-light-error text-error rounded f-w-600 p-6 p-y-4 f-s-12">Inactif</span>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14"></th>
          <td mat-cell *matCellDef="let element">
            <button
              mat-icon-button
              [routerLink]="['/produits', element.productId]"
              aria-label="Voir produit"
            >
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <mat-paginator
      class="m-t-16"
      [length]="total"
      [pageIndex]="page - 1"
      [pageSize]="limit"
      [pageSizeOptions]="[5, 10, 25, 50]"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
    >
    </mat-paginator>
    }
  </mat-card-content>
</mat-card>
